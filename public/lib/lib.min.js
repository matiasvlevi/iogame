class Logger{}Logger.server=function(e){console.log(`[Server]: ${e}`)},globalThis.isBrowser="object"!=typeof process,isBrowser||(globalThis.Player=require("../player/player.js"));class World{constructor(){this.players={},this.tick=0,this.wn={x:800,y:800},this.skins={default:[255,255,255]}}update(){for(let e in world.players)world.players[e].update()}setSize(e,s){this.wn={x:e,y:s}}playerJoin(e="username"){socket.emit("playerJoin",e)}addPlayer(e,s){if("string"==typeof e){let t=new Player(e,s);return t.setPos(Math.random()*this.wn.x,Math.random()*this.wn.y),this.players[s]=t,t}if("object"==typeof e){let s=new Player;return s=World.fromObject(s,e),this.players[e.sid]=s,s}}removePlayer(e){delete this.players[e]}static fromObject(e,s){let t=Object.keys(e),r=Object.values(s);for(let s=0;s<t.length;s++)e[t[s]]=r[s];return e}toObject(){let e=Object.keys(this),s=Object.values(this),t={};for(let r=0;r<e.length;r++)t[e[r]]=s[r];return t}render(e){let s=Object.values(this.players);for(let t=0;t<s.length;t++)s[t].render(e.sid)}}let world,player;isBrowser||(module.exports=new World),globalThis.isBrowser="object"!=typeof process,isBrowser?void 0===world&&(world=new World):world=require("../env/world.js");class Player{constructor(e,s,t=0,r=0){this.pos={x:t,y:r},this.vel={x:0,y:0},this.size=16,this.self=!1,this.username=e,this.sid=s,this.skin="default",this.speed=1.5}toObject(){let e=Object.keys(this),s=Object.values(this),t={};for(let r=0;r<e.length;r++)t[e[r]]=s[r];return t}setPos(e,s){this.pos={x:e,y:s}}render(e){this.sid===e&&(fill(100,100,100,100),ellipse(this.pos.x,this.pos.y,64,64)),noStroke(),fill.apply(1,world.skins[this.skin]),ellipse(this.pos.x,this.pos.y,this.size,this.size),text(this.username,this.pos.x+this.size,this.pos.y+this.size)}update(){this.self&&(keyIsDown(UP_ARROW)?this.addForce(0,-1):keyIsDown(DOWN_ARROW)&&this.addForce(0,1),keyIsDown(LEFT_ARROW)?this.addForce(-1,0):keyIsDown(RIGHT_ARROW)&&this.addForce(1,0)),this.pos.x+=this.vel.x,this.pos.y+=this.vel.y,this.vel.x*=.9,this.vel.y*=.9}addForce(e,s){this.vel.x+=e*this.speed,this.vel.y+=s*this.speed,console.log(this.pos,this.vel),socket.emit("updatePos",{sid:this.sid,pos:this.pos,vel:this.vel})}}function setup(){let e=window.innerWidth,s=window.innerHeight;createCanvas(e,s),world.playerJoin(prompt("Nickname:")),world.setSize(e,s)}function draw(){background(51),world.render(player),world.update()}isBrowser||(module.exports=Player),isBrowser&&(socket.on("newPlayer",(e=>{world.addPlayer(e),Logger.server(`${e.username} joined the game!`)})),socket.on("removePlayer",(e=>{delete world.players[e],Logger.server(`player ${e} left the game`)})),socket.on("selfPlayer",(e=>{player=World.fromObject(new Player,e),world.players[e.sid].self=!0})),socket.on("updatePosClient",(e=>{world.players[e.sid].pos=e.pos,world.players[e.sid].vel=e.vel})));